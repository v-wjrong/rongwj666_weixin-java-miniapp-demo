# 系统架构

## 系统概览

该项目是一个基于Java Spring Boot的微信小程序后端服务，专注于提供微信生态系统的官方API集成能力。

* **项目核心功能与业务领域：**
    * 核心功能为微信小程序服务端API对接，包括消息服务器配置、用户身份验证、模板消息推送等标准微信生态功能
    * 业务领域属于社交平台服务集成层，作为微信小程序与业务系统之间的中间件存在

* **架构模式：**
    * **单体应用架构**，具有以下显著特征：
        * 单一Docker容器部署模式（仅包含Spring Boot应用容器）
        * 应用配置集中管理于单个application.yml文件
        * 项目结构未显示微服务特有的服务拆分或API网关配置
        * 采用传统的Maven单体项目构建方式（通过mvn clean package命令）

* **架构模式支撑依据：**
    * `docker-compose.yml`的缺失表明系统可能采用简单部署模式
    * 唯一的Dockerfile构建的是包含完整功能的fat jar
    * 配置文件中wx.miniapp.configs显示多租户支持通过单体应用内的配置实现
    * 日志配置集中管理，未出现跨服务日志聚合的需求

## 核心组件与功能图谱

系统采用经典的三层架构设计，但数据访问层与业务逻辑层在Spring Boot框架内紧密集成。

* **流量入口层 (Traffic Entry Layer)：**
    * **组件与职责：**
        * 嵌入式Tomcat服务器：作为唯一的流量入口，处理HTTPS协议的小程序API调用
        * 微信消息服务器验证模块：独立处理微信服务器验证的GET请求路由
    * **实现考量：**
        * 直接暴露Spring Boot应用端口（默认8080）的简化设计
        * 依赖微信小程序端的安全通信机制，未配置额外的API网关

* **应用服务层 (Application Service Layer)：**
    * **服务清单与核心功能：**
        * 微信API代理服务：
            * **主要职责**：封装微信开放平台所有小程序相关API（用户登录code2session、支付通知、订阅消息等）
            * **技术基座**：Java 8 + Spring Boot 2.x + WxJava SDK
            * **内部结构**：
                - `controller/`：处理微信服务器推送事件和API调用
                - `service/`：实现微信API签名验证、加解密等核心逻辑
                - `config/`：管理多小程序配置的自动装载

* **数据管理层 (Data Management Layer)：**
    * **数据存储组件：**
        * 内存存储：采用Spring Cache抽象层缓存access_token等微信API凭证
        * 潜在关系型数据库：虽未显式配置，但预留了JPA依赖接入可能
    * **数据策略：**
        * 微信会话密钥采用内存存储保证临时性
        * 消息模板配置通过YML文件静态管理

## 容器配置概览

系统采用极简的容器化部署方案，仅包含基础应用容器。

| 服务名称 | 容器镜像 | 暴露端口 | 挂载卷 | 关键环境变量 | 启动命令/入口点 |
|---------|----------|---------|-------|-------------|----------------|
| miniapp-service | openjdk:8-jdk-alpine构建 | 8080 (内部) | /tmp临时卷 | JAVA安全随机数配置 | java -jar /app.jar |

## 服务间协作与数据流转

系统交互模式高度标准化，主要遵循微信官方定义的通信协议。

* **核心通信路径：**
    1. 微信服务器 → HTTPS → Spring Boot消息控制器
    2. 控制器 → 服务层 → 微信开放平台API端点
* **安全交互机制：**
    * 双向HTTPS加密通信
    * 微信签名验证（SHA1）
    * 消息体AES-256-CBC加密
* **数据持久化策略：**
    * 敏感配置通过环境变量注入
    * 会话状态完全无状态化设计

## 整体架构概览图

```mermaid
graph TD
    WX[微信服务器] -- HTTPS/加密消息 --> T[Tomcat 8080]
    subgraph Spring Boot应用
        T --> C[消息控制器]
        C --> S[微信服务层]
        S --> WXSDK[WxJava SDK]
    end
    S --> Cache[(内存缓存)]
    style WX fill:#22bb33,stroke:#333
    style Cache fill:#ffbb33,stroke:#333



